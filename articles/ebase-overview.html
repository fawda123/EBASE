<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EBASE">
<title>EBASE overview • EBASE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EBASE overview">
<meta property="og:description" content="EBASE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EBASE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ebase-overview.html">EBASE overview</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fawda123/EBASE/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="ebase-overview_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>EBASE overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/fawda123/EBASE/blob/HEAD/vignettes/ebase-overview.Rmd" class="external-link"><code>vignettes/ebase-overview.Rmd</code></a></small>
      <div class="d-none name"><code>ebase-overview.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>This vignette provides an overview of the theory and use of the the Estuarine BAyesian Single-station Estimation (EBASE) R package for ecosystem metabolism. Use the following to install the package from R-Universe. The <a href="https://mcmc-jags.sourceforge.io/" class="external-link">JAGS</a> software must also be installed to use this package. Follow the instructions in the link to download and install the JAGS version appropriate for your operating system.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Enable the r-universe repo</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    fawda123 <span class="op">=</span> <span class="st">'https://fawda123.r-universe.dev'</span>,
    CRAN <span class="op">=</span> <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Install</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'EBASE'</span><span class="op">)</span></code></pre></div>
<p>Load the package after installation to use the functions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fawda123.github.io/EBASE">EBASE</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>An example file called <code><a href="../reference/exdat.html">exdat()</a></code> is included with the package that demonstrates the required time series format to use the functions. It includes nearly a year of continuously monitored water quality and meteorological data at the Apalachicola National Estuarine Research Reserve. The required data include a date and time vector (<code>DateTimeStamp</code>), dissolved oxygen (mg/L, <code>DO_obs</code>) , water temperature (C, <code>Temp</code>), salinity (psu, <code>Sal</code>), PAR (W/m2/s, <code>PAR</code>), and wind speed (m/s, <code>WSpd</code>). The time step should be consistent throughout the dataset and is indicated as an argument to the <code><a href="../reference/ebase.html">ebase()</a></code> function (see below). The <code><a href="../reference/exdat.html">exdat()</a></code> dataset can be viewed at any time after the package is loaded and is used in the examples in the help files:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">exdat</span><span class="op">)</span>
<span class="co">#&gt;         DateTimeStamp   DO_obs Temp  Sal PAR WSpd</span>
<span class="co">#&gt; 1 2012-02-23 00:00:00 8.217998 16.4 23.0   0  3.6</span>
<span class="co">#&gt; 2 2012-02-23 00:15:00 8.210692 16.4 22.8   0  3.5</span>
<span class="co">#&gt; 3 2012-02-23 00:30:00 8.203855 16.4 22.7   0  3.6</span>
<span class="co">#&gt; 4 2012-02-23 00:45:00 8.197538 16.4 22.9   0  4.2</span>
<span class="co">#&gt; 5 2012-02-23 01:00:00 8.191786 16.4 22.7   0  3.6</span>
<span class="co">#&gt; 6 2012-02-23 01:15:00 8.186632 16.4 23.4   0  4.1</span></code></pre></div>
<p>The core function to estimate metabolism is <code><a href="../reference/ebase.html">ebase()</a></code>. The metabolic estimates are based on a mass balance equation in <span class="citation">Grace et al. (2015)</span> with the gas exchange estimate from <span class="citation">Wanninkhof (2014)</span>. It is similar to that provided by the BASEmetab R package at <a href="https://github.com/dgiling/BASEmetab" class="external-link uri">https://github.com/dgiling/BASEmetab</a>, with modifications to estimate different parameters optimized by the JAGS model:</p>
<p><span class="math display">\[
\frac{\delta{C_d}}{\delta{t}} = [\,aPAR]\, - [\,r]\, - \frac{1}{H}\left[-bU_{10}^2\left(\frac{s_c}{600} \right)^{-0.5} \left(C_{Sat} - C_d \right )\right]
\]</span></p>
<p>The metabolic estimates are defined by the change in dissolved oxygen over the time step <span class="math inline">\(\frac{\delta{C_d}}{\delta{t}}\)</span>, where gross production is provided by <span class="math inline">\(aPAR\)</span>, respiration is provided by <span class="math inline">\(r\)</span>, and gas exchange is provided by the remainder. Required inputs for the equation are dissolved oxygen concentration as <span class="math inline">\(C_d\)</span>, solar radiation as <span class="math inline">\(PAR\)</span>, water column depth as <span class="math inline">\(H\)</span> (meters), and wind speed as <span class="math inline">\(U\)</span>. Other inputs for the schmidt number <span class="math inline">\(s_c\)</span> and dissolved oxygen at saturation <span class="math inline">\(C_{Sat}\)</span> are calculated from the observed data by the package. The remaining three parameters <span class="math inline">\(a\)</span>, <span class="math inline">\(r\)</span>, and <span class="math inline">\(b\)</span> are estimated by likelihood given the observed data with the JAGS model using prior distributions shown in the model file. At each time step, the change in oxygen concentration between time steps is calculated from the equation using model inputs and parameter guesses, and then a finite difference approximation is used to estimate modeled oxygen concentration. The estimated concentration is also returned, which can be compared to observed as one measure of model performance.</p>
<p>The following shows how to use the <code><a href="../reference/ebase.html">ebase()</a></code> function with a subset of four days from the <code><a href="../reference/exdat.html">exdat()</a></code> example dataset. Running the model on the entire year will take a few minutes, so a subset is used:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>

<span class="co"># subset four days in June</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">exdat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">exdat</span><span class="op">$</span><span class="va">DateTimeStamp</span><span class="op">)</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">exdat</span><span class="op">$</span><span class="va">DateTimeStamp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt;         DateTimeStamp   DO_obs Temp  Sal PAR WSpd</span>
<span class="co">#&gt; 1 2012-06-01 00:00:00 5.185803 29.5 23.0   0  2.0</span>
<span class="co">#&gt; 2 2012-06-01 00:15:00 5.174494 29.5 23.3   0  2.3</span>
<span class="co">#&gt; 3 2012-06-01 00:30:00 5.163948 29.5 23.4   0  2.1</span>
<span class="co">#&gt; 4 2012-06-01 00:45:00 5.154150 29.5 23.3   0  2.0</span>
<span class="co">#&gt; 5 2012-06-01 01:00:00 5.145070 29.5 23.1   0  1.7</span>
<span class="co">#&gt; 6 2012-06-01 01:15:00 5.136675 29.5 24.0   0  1.8</span></code></pre></div>
<p>Then, the <code><a href="../reference/ebase.html">ebase()</a></code> function is used to estimate the metabolic rates with the appropriate function arguments. The timestep <code>interval</code> is 900 seconds (15 minutes), the water column depth <code>H</code> is 1.85 meters, a log file of the model iterations for each day is created by setting <code>progress = TRUE</code>, and only two Markov chains are used with <code>n.chains = 2</code>. In practice, a larger number for <code>n.chains</code> should be used to verify model convergence.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebase.html">ebase</a></span><span class="op">(</span><span class="va">dat</span>, interval <span class="op">=</span> <span class="fl">900</span>, H <span class="op">=</span> <span class="fl">1.85</span>, progress <span class="op">=</span> <span class="cn">TRUE</span>, n.chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt;         Date   DO_obs   DO_mod       DateTimeStamp       dDO          a</span>
<span class="co">#&gt; 2 2012-06-01 161.7030 161.9898 2012-06-01 00:15:00 -6.392482 0.00766078</span>
<span class="co">#&gt; 3 2012-06-01 161.3734 161.9472 2012-06-01 00:30:00 -4.082373 0.00766078</span>
<span class="co">#&gt; 4 2012-06-01 161.0672 161.8878 2012-06-01 00:45:00 -5.703880 0.00766078</span>
<span class="co">#&gt; 5 2012-06-01 160.7834 161.8209 2012-06-01 01:00:00 -6.423503 0.00766078</span>
<span class="co">#&gt; 6 2012-06-01 160.5211 161.7332 2012-06-01 01:15:00 -8.420908 0.00766078</span>
<span class="co">#&gt; 7 2012-06-01 160.2787 161.6509 2012-06-01 01:30:00 -7.903096 0.00766078</span>
<span class="co">#&gt;           b Pg_vol   Rt_vol        D</span>
<span class="co">#&gt; 2 0.2259031      0 13.74739 7.354905</span>
<span class="co">#&gt; 3 0.2259031      0 13.74739 9.665015</span>
<span class="co">#&gt; 4 0.2259031      0 13.74739 8.043508</span>
<span class="co">#&gt; 5 0.2259031      0 13.74739 7.323884</span>
<span class="co">#&gt; 6 0.2259031      0 13.74739 5.326479</span>
<span class="co">#&gt; 7 0.2259031      0 13.74739 5.844291</span></code></pre></div>
<p>The results are returned as a data frame with instantaneous metabolic estimates for volumetric gross production (O2 mmol/m3/d, <code>Pg_vol</code> or <span class="math inline">\(aPAR\)</span> from above), respiration (O2 mmol/m3/d, <code>Rt_vol</code> or <span class="math inline">\(r\)</span> from above), and gas exchange (O2 mmol/m3/d, <code>D</code> or the remainder of the equation from above). Additional parameters estimated by the model that are returned include <code>a</code> and <code>b</code> as shown in the above equation. The <code>a</code> parameter is a constant that represents the primary production per quantum of light with units of (mmol/m3/d)(W/m2) and is used to estimate gross production <span class="citation">(Grace et al. 2015)</span>. The <code>b</code> parameter is a constant used to estimate gas exchange in hr/cm (provided as 0.251 in eqn. 4 in <span class="citation">Wanninkhof (2014)</span>).</p>
<p>A plot of the results can be made with <code><a href="../reference/ebase_plot.html">ebase_plot()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ebase_plot.html">ebase_plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<p><img src="ebase-overview_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;"></p>
<p>The daily averages can also be plotted by using <code>instantaneous = FALSE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ebase_plot.html">ebase_plot</a></span><span class="op">(</span><span class="va">res</span>, instantaneous <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="ebase-overview_files/figure-html/unnamed-chunk-6-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Execution time of the model can also be reduced by using multiple processors. This is done using <a href="https://cran.r-project.org/web/packages/doParallel/index.html" class="external-link">doParrallel</a> package and registering a parallel backend as below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># setup parallel backend</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span>
<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebase.html">ebase</a></span><span class="op">(</span><span class="va">dat</span>, interval <span class="op">=</span> <span class="fl">900</span>, H <span class="op">=</span> <span class="fl">1.85</span>, progress <span class="op">=</span> <span class="cn">TRUE</span>, n.chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-Grace15">
<p>Grace, Michael R, Darren P Giling, Sally Hladyz, Valerie Caron, Ross M Thompson, and Ralph Mac Nally. 2015. “Fast Processing of Diel Oxygen Curves: Estimating Stream Metabolism with Base (Ba Yesian S Ingle-Station E Stimation).” <em>Limnology and Oceanography: Methods</em> 13 (3): 103–14. <a href="https://doi.org/10.1002/lom3.10011" class="external-link">https://doi.org/10.1002/lom3.10011</a>.</p>
</div>
<div id="ref-Wanninkhof14">
<p>Wanninkhof, Rik. 2014. “Relationship Between Wind Speed and Gas Exchange over the Ocean Revisited.” <em>Limnology and Oceanography: Methods</em> 12 (6): 351–62. <a href="https://doi.org/10.4319/lom.2014.12.351" class="external-link">https://doi.org/10.4319/lom.2014.12.351</a>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marcus Beck, Maria Herrmann, Jill Arriola, Raymond Najjar, Wade McGillis.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
